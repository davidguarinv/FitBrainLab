{% extends "base.html" %}
{% block title %}Communities - Fit Brain Lab{% endblock %}
{% block content %}
<main class="flex-1 min-h-screen">
    <section class="relative w-full py-24 md:py-32 lg:py-40 overflow-hidden">
        <!-- Animated Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-orange-900 via-red-900 to-pink-900">
          <!-- Floating Elements -->
          <div class="absolute top-20 left-10 w-16 h-16 border-2 border-orange-300/30 rounded-lg rotate-12 animate-pulse"></div>
          <div class="absolute top-40 right-20 w-12 h-12 border-2 border-red-300/30 rounded-full animate-bounce"></div>
          <div class="absolute bottom-32 left-1/4 w-20 h-20 border-2 border-pink-300/30 rounded-lg -rotate-12 animate-pulse"></div>
          <div class="absolute top-1/3 right-1/3 w-8 h-8 bg-orange-400/20 rounded-full animate-ping"></div>
          <div class="absolute bottom-20 right-10 w-14 h-14 border-2 border-red-400/30 rounded-lg rotate-45 animate-pulse"></div>
        </div>

        <div class="relative container mx-auto px-4 md:px-6">
          <div class="flex flex-col items-center text-center space-y-4 mb-8">
            <div class="space-y-2">
              <div class="inline-block rounded-lg bg-orange-100/90 backdrop-blur px-3 py-1 text-sm text-orange-700 font-medium mb-2">
                Community Network
              </div>
              <h1 class="text-3xl font-bold tracking-tighter sm:text-4xl md:text-5xl text-white">
                Find Your Fitness Community
              </h1>
              <p class="max-w-[800px] text-orange-100 md:text-xl">
                Discover the perfect fitness community in Amsterdam that matches your interests, schedule, and goals.
                Connect with like-minded individuals and build lasting exercise habits together.
              </p>
            </div>
          </div>
        </div>
    </section>

    <section class="container mx-auto px-4 md:px-6 py-8 md:py-12">
        <div class="mb-8 p-6 bg-gradient-to-r from-orange-50 to-red-50 rounded-xl border border-orange-100/50 shadow-lg backdrop-blur">
            <div class="flex flex-col md:flex-row gap-6 items-start md:items-end">
                <button id="mapToggle" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-orange-300 bg-white hover:bg-orange-100 hover:text-orange-600 h-10 px-4 py-2 gap-2 text-orange-700 w-full md:w-auto mt-4 md:mt-0 md:self-end">
                    <!-- Content dynamically set by JS -->
                </button>
                <div class="flex-1 space-y-2">
                    
                    <label htmlFor="searchInput" class="text-sm font-medium">
                        Search Communities
                    </label>
                    <div class="relative">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"
                        >
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.3-4.3"></path>
                        </svg>
                        <input
                            id="searchInput"
                            type="text"
                            placeholder="Search by name, sport, or location..."
                            class="flex h-10 w-full rounded-md border border-orange-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pl-8"
                        />
                    </div>
                </div>

                <div class="w-full md:w-[180px] space-y-2">
                    <label class="text-sm font-medium">Cost</label>
                    <select
                        id="costFilter"
                        class="flex h-10 w-full rounded-md border border-orange-200 bg-white px-3 py-2 text-sm ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                    >
                        <option value="all">All Costs</option>
                        <option value="Free">Free</option>
                        <option value="Paid">Paid</option>
                        <option value="NA">Contact for pricing</option>
                    </select>
                </div>

                <div class="w-full md:w-[200px] space-y-2">
                    <label class="text-sm font-medium">Student Focus</label>
                    <select
                        id="studentFilter"
                        class="flex h-10 w-full rounded-md border border-orange-200 bg-white px-3 py-2 text-sm ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                    >
                        <option value="all">All Groups</option>
                        <option value="Yes">Student-Based</option>
                        <option value="No">Open to All</option>
                    </select>
                </div>

                <div class="w-full md:w-[180px] space-y-2">
                    <label class="text-sm font-medium">Sport</label>
                    <select
                        id="sportFilter"
                        class="flex h-10 w-full rounded-md border border-orange-200 bg-white px-3 py-2 text-sm ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                    >
                        <option value="all">All Sports</option>
                        <!-- Options populated by JS -->
                    </select>
                </div>

                

                <button id="clearFilters" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-orange-300 bg-white hover:bg-orange-100 hover:text-orange-600 h-10 px-4 py-2 gap-2 text-orange-700 w-full md:w-auto">
                    <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-4 w-4"
                    >
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                    </svg>
                    <span>Reset Filters</span>
                </button>
            </div>
        </div>
    </section>

    <section class="relative w-full pb-12 md:pb-24">
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_1px_1px,rgba(251,146,60,0.05)_1px,transparent_0)] bg-[size:20px_20px] pointer-events-none"></div>
      <div class="relative container mx-auto px-4 md:px-6">
        <div class="flex flex-col lg:flex-row gap-6">
            <div id="mapContainer" class="hidden lg:w-1/2 bg-white rounded-lg shadow-sm overflow-hidden" style="height: 600px;" data-map-open="true">
                <div id="map" class="w-full h-full bg-gradient-to-br from-orange-100 to-red-100 flex items-center justify-center">
                    <!-- Map Placeholder Content if map doesn't load, or before it loads -->
                     <div class="text-center text-orange-700">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="h-16 w-16 mx-auto mb-4">
                            <polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"></polygon>
                            <line x1="9" x2="9" y1="3" y2="18"></line>
                            <line x1="15" x2="15" y1="6" y2="21"></line>
                        </svg>
                        <p class="text-lg font-semibold">Interactive Map</p>
                        <p class="text-sm">Community locations will appear here</p>
                    </div>
                </div>
            </div>

            <div id="communitiesWrapper" class="w-full"> 
                <div class="mb-6 flex justify-between items-center">
                    <h2 id="communitiesCount" class="text-xl font-bold text-slate-800">Communities (0)</h2>
                </div>
                <div id="communitiesContainer" class="w-full"> 
                     <div id="communitiesGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4" data-map-open-class="gap-3 md:gap-2">
                        <!-- Communities will be rendered here by JS -->
                    </div>

                    <div id="loadingState" class="text-center py-12 hidden">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 mx-auto mb-4"></div>
                        <p class="text-gray-600">Loading communities...</p>
                    </div>

                    <div id="noResults" class="text-center py-12 hidden">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            strokeWidth="2"
                            strokeLinecap="round"
                            strokeLinejoin="round"
                            class="h-12 w-12 text-gray-400 mx-auto mb-4"
                        >
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.3-4.3"></path>
                        </svg>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">No communities found</h3>
                        <p class="text-gray-600">Try adjusting your filters or search terms</p>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </section>

    <section class="w-full py-16 bg-gradient-to-br from-orange-900 via-red-900 to-pink-900">
        <div class="container mx-auto px-4 md:px-6 max-w-2xl">
            <div class="bg-white/10 backdrop-blur rounded-xl shadow-lg p-8 border border-orange-300/30">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold mb-4 text-white">Add Your Community</h2>
                    <p class="text-orange-100">Help us grow our community directory by adding your sports group or club.</p>
                </div>

                {% if suggestion_sent %}
                    <div class="bg-green-100 border border-green-200 text-green-700 px-4 py-3 rounded-lg relative mb-6 text-center" role="alert">
                        <strong class="font-bold">Thank you!</strong>
                        <span class="block sm:inline"> Your suggestion was sent.</span>
                    </div>
                {% endif %}

                <form method="POST" action="{{ url_for('main.submit_community') }}" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-orange-100 mb-1">Community Name</label>
                            <input type="text" name="Name" placeholder="e.g., Amsterdam Running Club"
                                class="flex h-10 w-full rounded-md border border-orange-200/50 bg-white/20 px-3 py-2 text-sm text-white placeholder-orange-100/70 ring-offset-orange-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-orange-100 mb-1">Contact Email</label>
                            <input type="email" name="email" placeholder="contact@example.com"
                                class="flex h-10 w-full rounded-md border border-orange-200/50 bg-white/20 px-3 py-2 text-sm text-white placeholder-orange-100/70 ring-offset-orange-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-orange-100 mb-1">Address</label>
                            <input type="text" name="Address" placeholder="e.g., Science Park 904, Amsterdam"
                                class="flex h-10 w-full rounded-md border border-orange-200/50 bg-white/20 px-3 py-2 text-sm text-white placeholder-orange-100/70 ring-offset-orange-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-orange-100 mb-1">Sport</label>
                            <input type="text" name="Sport" placeholder="e.g., Running, Football"
                                class="flex h-10 w-full rounded-md border border-orange-200/50 bg-white/20 px-3 py-2 text-sm text-white placeholder-orange-100/70 ring-offset-orange-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-orange-100 mb-1">Website URL</label>
                            <input type="url" name="website" placeholder="https://yourclub.com"
                                class="flex h-10 w-full rounded-md border border-orange-200/50 bg-white/20 px-3 py-2 text-sm text-white placeholder-orange-100/70 ring-offset-orange-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-orange-100 mb-1">Logo URL (Optional)</label>
                            <input type="url" name="image_url" placeholder="https://yourclub.com/logo.png"
                                class="flex h-10 w-full rounded-md border border-orange-200/50 bg-white/20 px-3 py-2 text-sm text-white placeholder-orange-100/70 ring-offset-orange-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-orange-100 mb-1">Cost</label>
                             <input type="text" name="Cost" placeholder="Free, Paid, or NA"
                                class="flex h-10 w-full rounded-md border border-orange-200/50 bg-white/20 px-3 py-2 text-sm text-white placeholder-orange-100/70 ring-offset-orange-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-orange-100 mb-1">Student-based?</label>
                            <select name="Student-based" class="flex h-10 w-full rounded-md border border-orange-200/50 bg-white/20 px-3 py-2 text-sm text-white ring-offset-orange-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2 child:text-gray-800">
                                <option value="" class="text-gray-500">Select...</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>


                    <div>
                        <label class="block text-sm font-medium text-orange-100 mb-1">Additional Information</label>
                        <textarea name="message" placeholder="Tell us about your community..." rows="4"
                            class="flex w-full rounded-md border border-orange-200/50 bg-white/20 px-3 py-2 text-sm text-white placeholder-orange-100/70 ring-offset-orange-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2"></textarea>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="inline-flex items-center justify-center rounded-full text-lg font-semibold bg-orange-500 hover:bg-orange-600 text-white h-12 px-8 py-3 transition-colors w-full md:w-auto">
                            Submit Community
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>
</main>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<script src="/static/js/communities.js"></script>
{% endblock %}